(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var b={ability:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},activation:{type:"text"},duration:{type:"number"},potency:{type:"number"},range:{type:"number"},effects:{type:"multi_link",target:"phenomenon"},challenges:{type:"text"},talents:{type:"multi_link",target:"trait"},requisites:{type:"multi_link",target:"construct"},prevalence:{type:"text"},tradition:{type:"single_link",target:"construct"},source:{type:"single_link",target:"phenomenon"},locus:{type:"single_link",target:"location"},instruments:{type:"multi_link",target:"object"},systems:{type:"multi_link",target:"construct"}},character:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},physicality:{type:"text"},mentality:{type:"text"},height:{type:"number"},weight:{type:"number"},species:{type:"multi_link",target:"species"},traits:{type:"multi_link",target:"trait"},abilities:{type:"multi_link",target:"ability"},background:{type:"text"},motivations:{type:"text"},birth_date:{type:"number"},birthplace:{type:"single_link",target:"location"},languages:{type:"multi_link",target:"language"},reputation:{type:"text"},location:{type:"single_link",target:"location"},objects:{type:"multi_link",target:"object"},institutions:{type:"multi_link",target:"institution"},charisma:{type:"number"},coercion:{type:"number"},competence:{type:"number"},compassion:{type:"number"},creativity:{type:"number"},courage:{type:"number"},family:{type:"multi_link",target:"family"},friends:{type:"multi_link",target:"character"},rivals:{type:"multi_link",target:"character"},level:{type:"number"},hit_points:{type:"number"},STR:{type:"number"},DEX:{type:"number"},CON:{type:"number"},INT:{type:"number"},WIS:{type:"number"},CHA:{type:"number"}},collective:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},composition:{type:"text"},count:{type:"number"},formation_date:{type:"number"},operator:{type:"single_link",target:"institution"},equipment:{type:"multi_link",target:"construct"},activity:{type:"text"},disposition:{type:"text"},state:{type:"text"},abilities:{type:"multi_link",target:"ability"},symbolism:{type:"multi_link",target:"construct"},species:{type:"multi_link",target:"species"},characters:{type:"multi_link",target:"character"},creatures:{type:"multi_link",target:"creature"},phenomena:{type:"multi_link",target:"phenomenon"}},construct:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},rationale:{type:"text"},history:{type:"text"},status:{type:"text"},reach:{type:"text"},start_date:{type:"number"},end_date:{type:"number"},founder:{type:"single_link",target:"character"},custodian:{type:"single_link",target:"institution"},characters:{type:"multi_link",target:"character"},objects:{type:"multi_link",target:"object"},locations:{type:"multi_link",target:"location"},species:{type:"multi_link",target:"species"},creatures:{type:"multi_link",target:"creature"},institutions:{type:"multi_link",target:"institution"},traits:{type:"multi_link",target:"trait"},collectives:{type:"multi_link",target:"collective"},zones:{type:"multi_link",target:"zone"},abilities:{type:"multi_link",target:"ability"},phenomena:{type:"multi_link",target:"phenomenon"},languages:{type:"multi_link",target:"language"},families:{type:"multi_link",target:"family"},relations:{type:"multi_link",target:"relation"},titles:{type:"multi_link",target:"title"},constructs:{type:"multi_link",target:"construct"},events:{type:"multi_link",target:"event"},narratives:{type:"multi_link",target:"narrative"}},creature:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},appearance:{type:"text"},weight:{type:"number"},height:{type:"number"},species:{type:"multi_link",target:"species"},habits:{type:"text"},demeanor:{type:"text"},traits:{type:"multi_link",target:"trait"},abilities:{type:"multi_link",target:"ability"},languages:{type:"multi_link",target:"language"},status:{type:"text"},birth_date:{type:"number"},location:{type:"single_link",target:"location"},zone:{type:"single_link",target:"zone"},challenge_rating:{type:"number"},hit_points:{type:"number"},armor_class:{type:"number"},speed:{type:"number"},actions:{type:"multi_link",target:"ability"}},event:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},history:{type:"text"},challenges:{type:"text"},consequences:{type:"text"},start_date:{type:"number"},end_date:{type:"number"},triggers:{type:"multi_link",target:"event"},characters:{type:"multi_link",target:"character"},objects:{type:"multi_link",target:"object"},locations:{type:"multi_link",target:"location"},species:{type:"multi_link",target:"species"},creatures:{type:"multi_link",target:"creature"},institutions:{type:"multi_link",target:"institution"},traits:{type:"multi_link",target:"trait"},collectives:{type:"multi_link",target:"collective"},zones:{type:"multi_link",target:"zone"},abilities:{type:"multi_link",target:"ability"},phenomena:{type:"multi_link",target:"phenomenon"},languages:{type:"multi_link",target:"language"},families:{type:"multi_link",target:"family"},relations:{type:"multi_link",target:"relation"},titles:{type:"multi_link",target:"title"},constructs:{type:"multi_link",target:"construct"}},family:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},spirit:{type:"text"},history:{type:"text"},traditions:{type:"multi_link",target:"construct"},traits:{type:"multi_link",target:"trait"},abilities:{type:"multi_link",target:"ability"},languages:{type:"multi_link",target:"language"},ancestors:{type:"multi_link",target:"character"},reputation:{type:"text"},estates:{type:"multi_link",target:"location"},governs:{type:"multi_link",target:"institution"},heirlooms:{type:"multi_link",target:"object"},creatures:{type:"multi_link",target:"creature"}},institution:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},doctrine:{type:"text"},founding_date:{type:"number"},parent_institution:{type:"single_link",target:"institution"},zones:{type:"multi_link",target:"zone"},objects:{type:"multi_link",target:"object"},creatures:{type:"multi_link",target:"creature"},status:{type:"text"},allies:{type:"multi_link",target:"institution"},adversaries:{type:"multi_link",target:"institution"},constructs:{type:"multi_link",target:"construct"}},language:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},phonology:{type:"text"},grammar:{type:"text"},lexicon:{type:"text"},writing:{type:"text"},classification:{type:"single_link",target:"construct"},status:{type:"text"},spread:{type:"multi_link",target:"location"},dialects:{type:"multi_link",target:"language"}},law:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},declaration:{type:"text"},purpose:{type:"text"},date:{type:"number"},parent_law:{type:"single_link",target:"law"},penalties:{type:"multi_link",target:"construct"},author:{type:"single_link",target:"institution"},locations:{type:"multi_link",target:"location"},zones:{type:"multi_link",target:"zone"},prohibitions:{type:"multi_link",target:"construct"},adjudicators:{type:"multi_link",target:"title"},enforcers:{type:"multi_link",target:"title"}},location:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},form:{type:"text"},function:{type:"text"},founding_date:{type:"number"},parent_location:{type:"single_link",target:"location"},populations:{type:"multi_link",target:"collective"},political_climate:{type:"text"},primary_power:{type:"single_link",target:"institution"},governing_title:{type:"single_link",target:"title"},secondary_powers:{type:"multi_link",target:"institution"},zone:{type:"single_link",target:"zone"},rival:{type:"single_link",target:"location"},partner:{type:"single_link",target:"location"},customs:{type:"text"},founders:{type:"multi_link",target:"character"},cults:{type:"multi_link",target:"construct"},delicacies:{type:"multi_link",target:"species"},extraction_methods:{type:"multi_link",target:"construct"},extraction_goods:{type:"multi_link",target:"construct"},industry_methods:{type:"multi_link",target:"construct"},industry_goods:{type:"multi_link",target:"construct"},infrastructure:{type:"text"},extraction_markets:{type:"multi_link",target:"location"},industry_markets:{type:"multi_link",target:"location"},currencies:{type:"multi_link",target:"construct"},architecture:{type:"text"},buildings:{type:"multi_link",target:"object"},building_methods:{type:"multi_link",target:"construct"},defensibility:{type:"text"},elevation:{type:"number"},fighters:{type:"multi_link",target:"construct"},defensive_objects:{type:"multi_link",target:"object"}},map:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},background_color:{type:"text"},hierarchy:{type:"number"},width:{type:"number"},height:{type:"number"},depth:{type:"number"},parent_map:{type:"single_link",target:"map"},location:{type:"single_link",target:"location"}},marker:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},map:{type:"single_link",target:"map"},zone:{type:"single_link",target:"zone"},x:{type:"number"},y:{type:"number"},z:{type:"number"},order:{type:"number"}},narrative:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},story:{type:"text"},consequences:{type:"text"},start_date:{type:"number"},end_date:{type:"number"},order:{type:"number"},parent_narrative:{type:"single_link",target:"narrative"},protagonist:{type:"single_link",target:"character"},antagonist:{type:"single_link",target:"character"},narrator:{type:"single_link",target:"character"},conservator:{type:"single_link",target:"institution"},events:{type:"multi_link",target:"event"},characters:{type:"multi_link",target:"character"},objects:{type:"multi_link",target:"object"},locations:{type:"multi_link",target:"location"},species:{type:"multi_link",target:"species"},creatures:{type:"multi_link",target:"creature"},institutions:{type:"multi_link",target:"institution"},traits:{type:"multi_link",target:"trait"},collectives:{type:"multi_link",target:"collective"},zones:{type:"multi_link",target:"zone"},abilities:{type:"multi_link",target:"ability"},phenomena:{type:"multi_link",target:"phenomenon"},languages:{type:"multi_link",target:"language"},families:{type:"multi_link",target:"family"},relations:{type:"multi_link",target:"relation"},titles:{type:"multi_link",target:"title"},constructs:{type:"multi_link",target:"construct"},laws:{type:"multi_link",target:"law"}},object:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},aesthetics:{type:"text"},weight:{type:"number"},amount:{type:"number"},parent_object:{type:"single_link",target:"object"},materials:{type:"multi_link",target:"construct"},technology:{type:"multi_link",target:"construct"},utility:{type:"text"},effects:{type:"multi_link",target:"phenomenon"},abilities:{type:"multi_link",target:"ability"},consumes:{type:"multi_link",target:"construct"},origins:{type:"text"},location:{type:"single_link",target:"location"},language:{type:"single_link",target:"language"},affinities:{type:"multi_link",target:"trait"}},phenomenon:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},expression:{type:"text"},effects:{type:"text"},duration:{type:"number"},catalysts:{type:"multi_link",target:"object"},empowerments:{type:"multi_link",target:"ability"},mythology:{type:"text"},system:{type:"single_link",target:"phenomenon"},triggers:{type:"multi_link",target:"construct"},wielders:{type:"multi_link",target:"character"},environments:{type:"multi_link",target:"location"}},pin:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},map:{type:"single_link",target:"map"},element_type:{type:"text"},element_id:{type:"single_link",target:"any"},x:{type:"number"},y:{type:"number"},z:{type:"number"}},relation:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},background:{type:"text"},start_date:{type:"number"},end_date:{type:"number"},intensity:{type:"number"},actor:{type:"single_link",target:"character"},events:{type:"multi_link",target:"event"},characters:{type:"multi_link",target:"character"},objects:{type:"multi_link",target:"object"},locations:{type:"multi_link",target:"location"},species:{type:"multi_link",target:"species"},creatures:{type:"multi_link",target:"creature"},institutions:{type:"multi_link",target:"institution"},traits:{type:"multi_link",target:"trait"},collectives:{type:"multi_link",target:"collective"},zones:{type:"multi_link",target:"zone"},abilities:{type:"multi_link",target:"ability"},phenomena:{type:"multi_link",target:"phenomenon"},languages:{type:"multi_link",target:"language"},families:{type:"multi_link",target:"family"},relations:{type:"multi_link",target:"relation"},titles:{type:"multi_link",target:"title"},constructs:{type:"multi_link",target:"construct"},narratives:{type:"multi_link",target:"narrative"}},species:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},appearance:{type:"text"},life_span:{type:"number"},weight:{type:"number"},nourishment:{type:"multi_link",target:"species"},reproduction:{type:"multi_link",target:"construct"},adaptations:{type:"multi_link",target:"ability"},instincts:{type:"text"},sociality:{type:"text"},temperament:{type:"text"},communication:{type:"text"},aggression:{type:"number"},traits:{type:"multi_link",target:"trait"},role:{type:"text"},parent_species:{type:"single_link",target:"species"},locations:{type:"multi_link",target:"location"},zones:{type:"multi_link",target:"zone"},affinities:{type:"multi_link",target:"phenomenon"}},title:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},authority:{type:"text"},eligibility:{type:"text"},grant_date:{type:"number"},revoke_date:{type:"number"},issuer:{type:"single_link",target:"institution"},body:{type:"single_link",target:"institution"},superior_title:{type:"single_link",target:"title"},holders:{type:"multi_link",target:"character"},symbols:{type:"multi_link",target:"object"},status:{type:"text"},history:{type:"text"},characters:{type:"multi_link",target:"character"},institutions:{type:"multi_link",target:"institution"},families:{type:"multi_link",target:"family"},zones:{type:"multi_link",target:"zone"},locations:{type:"multi_link",target:"location"},objects:{type:"multi_link",target:"object"},constructs:{type:"multi_link",target:"construct"},laws:{type:"multi_link",target:"law"},collectives:{type:"multi_link",target:"collective"},creatures:{type:"multi_link",target:"creature"},phenomena:{type:"multi_link",target:"phenomenon"},species:{type:"multi_link",target:"species"},languages:{type:"multi_link",target:"language"}},trait:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},social_effects:{type:"text"},physical_effects:{type:"text"},functional_effects:{type:"text"},personality_effects:{type:"text"},behaviour_effects:{type:"text"},charisma:{type:"number"},coercion:{type:"number"},competence:{type:"number"},compassion:{type:"number"},creativity:{type:"number"},courage:{type:"number"},significance:{type:"text"},anti_trait:{type:"single_link",target:"trait"},empowered_abilities:{type:"multi_link",target:"ability"}},zone:{name:{type:"text",required:!0},description:{type:"text",required:!1},supertype:{type:"text",required:!1},subtype:{type:"text",required:!1},image_url:{type:"text",required:!1},role:{type:"text"},start_date:{type:"number"},end_date:{type:"number"},phenomena:{type:"multi_link",target:"phenomenon"},linked_zones:{type:"multi_link",target:"zone"},context:{type:"text"},populations:{type:"multi_link",target:"collective"},titles:{type:"multi_link",target:"title"},principles:{type:"multi_link",target:"construct"}}},w=class{constructor(r){this.client=r}async getStatus(){return this.client.request("GET","/tokens/status/")}async consume(r){return this.client.request("POST","/tokens/consume/",{body:{amount:r.amount,service:r.service||"sdk_client",session_id:r.sessionId??null,metadata:r.metadata??null}})}async getAccessKey(){return this.client.request("GET","/tokens/access-key/")}async revokeSession(r){return this.client.request("POST",`/tokens/revoke-session/?session_id=${encodeURIComponent(r)}`)}async revokeAllSessions(){return this.client.request("POST","/tokens/revoke-all-sessions/")}async getEncryptionInfo(){return this.client.request("GET","/tokens/encryption-info/")}},s=class{constructor(r,t){this.client=r,this.elementType=t}async list(r){const t=await this.client.request("GET",`/${this.elementType}/`,{params:r});return Array.isArray(t)?{count:t.length,next:null,previous:null,results:t}:t}async get(r){return this.client.request("GET",`/${this.elementType}/${r}/`)}async create(r){let t=h.prepareRelations(r,this.elementType);return this.elementType==="pin"&&(t=this.roundPinCoordinates(t)),this.client.request("POST",`/${this.elementType}/`,{body:t})}async update(r,t){let e=h.prepareRelations(t,this.elementType);return this.elementType==="pin"&&(e=this.roundPinCoordinates(e)),this.client.request("PATCH",`/${this.elementType}/${r}/`,{body:e})}async delete(r){return this.client.request("DELETE",`/${this.elementType}/${r}/`)}roundPinCoordinates(r){const t={...r};return typeof t.x=="number"&&(t.x=Math.round(t.x)),typeof t.y=="number"&&(t.y=Math.round(t.y)),typeof t.z=="number"&&(t.z=Math.round(t.z)),t}},q=class{constructor(r){this.client=r}async get(){return this.client.request("GET","/world/")}async update(r){return this.client.request("PATCH","/world/",{body:r})}},h=class{constructor(r){this.baseUrl=r.baseUrl||"https://www.onlyworlds.com/api/worldapi",this.headers={"Content-Type":"application/json","API-Key":r.apiKey,"API-Pin":r.apiPin},this.worlds=new q(this),this.tokens=new w(this),this.abilities=new s(this,"ability"),this.characters=new s(this,"character"),this.collectives=new s(this,"collective"),this.constructs=new s(this,"construct"),this.creatures=new s(this,"creature"),this.events=new s(this,"event"),this.families=new s(this,"family"),this.institutions=new s(this,"institution"),this.languages=new s(this,"language"),this.laws=new s(this,"law"),this.locations=new s(this,"location"),this.maps=new s(this,"map"),this.markers=new s(this,"marker"),this.narratives=new s(this,"narrative"),this.objects=new s(this,"object"),this.phenomena=new s(this,"phenomenon"),this.pins=new s(this,"pin"),this.relations=new s(this,"relation"),this.species=new s(this,"species"),this.titles=new s(this,"title"),this.traits=new s(this,"trait"),this.zones=new s(this,"zone")}async request(r,t,e){const i=new URL(`${this.baseUrl}${t}`);e?.params&&Object.entries(e.params).forEach(([l,o])=>{o!=null&&i.searchParams.append(l,String(o))});const n={method:r,headers:this.headers};e?.body&&["POST","PATCH","PUT"].includes(r)&&(n.body=JSON.stringify(e.body));const a=await fetch(i.toString(),n);if(!a.ok){let l=`API Error ${a.status}`;try{const o=await a.text();if(o)try{const g=JSON.parse(o);if(Array.isArray(g.detail)){const x=g.detail.map(m=>`${m.loc?m.loc.join("."):"unknown"}: ${m.msg}`).join("; ");l+=`: ${x}`}else l+=`: ${g.detail||g.error||o}`}catch{l+=`: ${o}`}}catch{}throw new Error(l)}if(a.status!==204)return a.json()}static prepareInput(r){const t={...r};for(const[e,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)&&"id"in i?(delete t[e],t[`${e}_id`]=i.id):Array.isArray(i)&&i.length>0&&typeof i[0]=="object"&&"id"in i[0]&&(delete t[e],t[`${e}_ids`]=i.map(n=>n.id));return t}static prepareRelations(r,t){const e=b[t];if(!e)return r;const i={...r};for(const[n,a]of Object.entries(i)){const l=e[n];l&&(l.type==="single_link"?(delete i[n],a&&typeof a=="object"&&"id"in a?i[`${n}_id`]=a.id:(typeof a=="string"||a===null)&&(i[`${n}_id`]=a)):l.type==="multi_link"&&(delete i[n],Array.isArray(a)?a.length>0&&typeof a[0]=="object"&&"id"in a[0]?i[`${n}_ids`]=a.map(o=>o.id):i[`${n}_ids`]=a:i[`${n}_ids`]=[]))}return i}};const d="onlyworlds_auth";class p extends Error{constructor(t,e){super(t),this.code=e,this.name="AuthError"}}class v{constructor(){this.state={isAuthenticated:!1,client:null,world:null,credentials:null},this.authChangeCallbacks=[]}async authenticate(t,e){if(!t||!e)throw new p("API key and pin are required","INVALID_CREDENTIALS");try{const i=new h({apiKey:t,apiPin:e}),n=await i.worlds.get();if(!n)throw new p("No world found. Create a world at onlyworlds.com first","NO_WORLD");return this.state={isAuthenticated:!0,client:i,world:n,credentials:{apiKey:t,apiPin:e}},this.saveCredentials(t,e),this.notifyAuthChange(),!0}catch(i){throw this.clearAuth(),i instanceof p?i:new p(`Authentication failed: ${i instanceof Error?i.message:"Unknown error"}`,"NETWORK_ERROR")}}async tryAutoAuth(){const t=this.loadCredentials();if(!t)return!1;try{return await this.authenticate(t.apiKey,t.apiPin),!0}catch(e){throw this.clearStorage(),e}}getClient(){if(!this.state.client||!this.state.isAuthenticated)throw new p("Not authenticated. Call authenticate() first","INVALID_CREDENTIALS");return this.state.client}getWorld(){if(!this.state.world||!this.state.isAuthenticated)throw new p("Not authenticated. Call authenticate() first","INVALID_CREDENTIALS");return this.state.world}getCredentials(){return this.state.credentials}isAuthenticated(){return this.state.isAuthenticated}onAuthChange(t){this.authChangeCallbacks.push(t)}notifyAuthChange(){const t=this.state.isAuthenticated;this.authChangeCallbacks.forEach(e=>{try{e(t)}catch(i){console.error("Error in auth change callback:",i)}})}logout(){this.clearAuth(),this.clearStorage(),this.notifyAuthChange()}clearAuth(){this.state={isAuthenticated:!1,client:null,world:null,credentials:null}}saveCredentials(t,e){try{localStorage.setItem(d,JSON.stringify({apiKey:t,apiPin:e,timestamp:Date.now()}))}catch(i){console.warn("Could not save credentials to localStorage:",i)}}loadCredentials(){try{const t=localStorage.getItem(d);if(!t)return null;const e=JSON.parse(t);return!e.apiKey||!e.apiPin?null:{apiKey:e.apiKey,apiPin:e.apiPin}}catch(t){return console.warn("Could not load credentials from localStorage:",t),null}}clearStorage(){try{localStorage.removeItem(d)}catch(t){console.warn("Could not clear credentials from localStorage:",t)}}}const u=new v;class C{constructor(t){this.client=null,this.authManager=t,t.isAuthenticated()&&(this.client=t.getClient()),this.authManager.onAuthChange(e=>{e?this.client=this.authManager.getClient():this.client=null})}getClient(){if(!this.client)throw new Error("Not authenticated. Please connect first.");return this.client}isReady(){return this.client!==null}getResource(t){const e=this.getClient(),i=`${t}s`;return e[i]}async listElements(t,e){return await this.getResource(t).list(e)}async getElement(t,e){return await this.getResource(t).get(e)}async createElement(t,e){return await this.getResource(t).create(e)}async updateElement(t,e,i){return await this.getResource(t).update(e,i)}async deleteElement(t,e){return await this.getResource(t).delete(e)}get characters(){return this.getClient().characters}get creatures(){return this.getClient().creatures}get species(){return this.getClient().species}get families(){return this.getClient().families}get collectives(){return this.getClient().collectives}get institutions(){return this.getClient().institutions}get locations(){return this.getClient().locations}get objects(){return this.getClient().objects}get constructs(){return this.getClient().constructs}get abilities(){return this.getClient().abilities}get traits(){return this.getClient().traits}get titles(){return this.getClient().titles}get languages(){return this.getClient().languages}get laws(){return this.getClient().laws}get events(){return this.getClient().events}get narratives(){return this.getClient().narratives}get phenomena(){return this.getClient().phenomena}get relations(){return this.getClient().relations}get maps(){return this.getClient().maps}get pins(){return this.getClient().pins}get markers(){return this.getClient().markers}get zones(){return this.getClient().zones}get worlds(){return this.getClient().worlds}}let c=null;function f(r){return c||(c=new C(r)),c}function E(){if(!c)throw new Error("SDK Manager not initialized. Call initializeSDKManager first.");return c}class A{constructor(){this.container=null,this.toasts=[],this.maxToasts=3}init(){this.container=document.getElementById("toast-container"),this.container||console.warn("Toast container not found")}show(t,e="info",i=4e3){if(!this.container){console.error("Toast manager not initialized");return}const n={id:`toast-${Date.now()}-${Math.random()}`,message:t,type:e,duration:i};if(this.toasts.push(n),this.toasts.length>this.maxToasts){const a=this.toasts.shift();a&&this.removeToast(a.id)}this.renderToast(n)}success(t,e){this.show(t,"success",e)}error(t,e){this.show(t,"error",e)}info(t,e){this.show(t,"info",e)}renderToast(t){if(!this.container)return;const e=document.createElement("div");e.id=t.id,e.className=`ow-toast ow-toast-${t.type}`;const i=this.getIcon(t.type);e.innerHTML=`
      <span class="material-icons ow-toast-icon">${i}</span>
      <span class="ow-toast-message">${this.escapeHtml(t.message)}</span>
    `,this.container.appendChild(e),setTimeout(()=>{this.removeToast(t.id)},t.duration)}removeToast(t){const e=document.getElementById(t);e&&(e.style.opacity="0",e.style.transform="translateY(100%)",setTimeout(()=>{e.remove()},300)),this.toasts=this.toasts.filter(i=>i.id!==t)}getIcon(t){switch(t){case"success":return"check_circle";case"error":return"error";case"info":return"info";default:return"info"}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}clearAll(){this.toasts.forEach(t=>this.removeToast(t.id)),this.toasts=[]}}const y=new A;window.showToast=(r,t="info")=>{y.show(r,t)};function k(r){const t=u.getWorld();E(),r.innerHTML=`
    <div style="max-width: 1280px; margin: 0 auto; padding: var(--ow-space-4);">
      <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--ow-space-4); padding-bottom: var(--ow-space-2); border-bottom: 1px solid var(--ow-border-subtle);">
        <div>
          <h3 style="text-transform: lowercase;">${t.name}</h3>
          <p style="color: var(--ow-text-tertiary); font-size: var(--ow-text-sm);">connected</p>
        </div>
        <button id="logout-btn" class="btn-secondary btn-sm">logout</button>
      </header>

      <main id="main-content">
        <p style="color: var(--ow-text-secondary);">foundation ready. build your tool here.</p>
      </main>
    </div>
  `,document.getElementById("logout-btn").addEventListener("click",()=>{u.logout(),y.info("logged out"),window.location.reload()})}const _=document.getElementById("app");y.init();async function T(){try{if(await u.tryAutoAuth()){f(u),y.success(`connected to ${u.getWorld().name}`),k(_);return}}catch{}j()}function j(){_.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
      <div style="width: 100%; max-width: 400px; padding: var(--ow-space-4);">
        <h2 style="text-align: center; margin-bottom: var(--ow-space-1); text-transform: lowercase;">onlyworlds</h2>
        <p style="text-align: center; color: var(--ow-cyan-primary); margin-bottom: var(--ow-space-4); font-size: var(--ow-text-sm);">connect your world</p>

        <div style="display: flex; flex-direction: column; gap: var(--ow-space-2);">
          <input id="api-key" type="text" placeholder="api key" />
          <input id="api-pin" type="password" placeholder="pin" value="1111" />
          <button id="connect-btn" class="btn-primary" style="width: 100%; margin-top: var(--ow-space-1);">connect</button>
        </div>

        <p id="auth-error" style="color: var(--ow-error); text-align: center; margin-top: var(--ow-space-2); font-size: var(--ow-text-sm); display: none;"></p>
      </div>
    </div>
  `;const r=document.getElementById("connect-btn"),t=document.getElementById("api-key"),e=document.getElementById("api-pin"),i=document.getElementById("auth-error");r.addEventListener("click",async()=>{const n=t.value.trim(),a=e.value.trim();if(!n||!a){i.textContent="api key and pin required",i.style.display="block";return}r.textContent="connecting...",r.disabled=!0,i.style.display="none";try{await u.authenticate(n,a),f(u),y.success(`connected to ${u.getWorld().name}`),k(_)}catch(l){i.textContent=l instanceof Error?l.message:"connection failed",i.style.display="block",r.textContent="connect",r.disabled=!1}}),[t,e].forEach(n=>{n.addEventListener("keydown",a=>{a.key==="Enter"&&r.click()})})}T();
